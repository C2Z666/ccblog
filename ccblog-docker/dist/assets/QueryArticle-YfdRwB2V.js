import{d as te,u as se,r as h,a3 as ae,a1 as oe,l as ne,bI as le,c,a as e,b as o,h as F,b2 as ie,O as V,e as v,y as p,F as I,i as z,g as N,a6 as ce,aC as re,$ as ue,j as de,a0 as A,n as u,o as r,a7 as he,bJ as P,t as f,a8 as _e,D as ge,E as ve,_ as pe}from"./index-BAIhVknm.js";const _=k=>(ge("data-v-cd509a1a"),k=k(),ve(),k),me={class:"query-article-container"},ye={class:"search-section enhanced-search-section"},fe={class:"search-box modern-search-box"},ke=["disabled"],be={class:"search-button-content"},Ce=_(()=>e("span",null,"搜索",-1)),Se=_(()=>e("span",{class:"search-pulse"},null,-1)),xe={key:0,class:"search-history-container"},we={class:"search-history-header"},He={class:"history-title"},Ie={class:"search-history-list"},De=["onClick","title"],qe={class:"history-text"},Te={class:"content-container"},$e={class:"main-content"},ze={class:"article-area"},Ne=_(()=>e("div",{class:"section-header mb-4"},[e("h2",{class:"section-title"},[e("i",{class:"el-icon-document"}),p(" 搜索结果 ")]),e("div",{class:"section-divider"})],-1)),Le=_(()=>e("div",{class:"skeleton-divider"},null,-1)),Me={class:"main-content"},Re={class:"article-area"},Fe=_(()=>e("div",{class:"section-header mb-6"},[e("h2",{class:"section-title"},[e("i",{class:"el-icon-document-checked"}),p(" 搜索结果 ")]),e("div",{class:"section-divider"})],-1)),Ve={key:0,class:"article-list-wrapper"},Ae={class:"articles-grid"},Pe=["innerHTML"],Ee=["innerHTML"],je={class:"article-meta"},Be={class:"author-info"},Oe=["src","alt"],Ue={class:"article-date"},Ge={class:"article-stats"},Je=_(()=>e("i",{class:"el-icon-view"},null,-1)),Qe={class:"article-stats"},Ke=_(()=>e("i",{class:"el-icon-message"},null,-1)),Ye={key:1,class:"empty-state"},We=_(()=>e("div",{class:"empty-content"},[e("div",{class:"empty-icon"},[e("i",{class:"el-icon-search"})]),e("h3",null,"未找到相关内容"),e("p",{class:"empty-desc"},"尝试使用其他关键词进行搜索")],-1)),Xe=[We],Ze={key:2,class:"pagination-container"},et=te({__name:"QueryArticle",setup(k){const E=ue(),j=de(),B=se(),i=h(""),d=h(!1),m=h(1),L=h(0),b=h(10),g=ae({records:[],total:0,size:10,current:1,pages:0,orders:[],optimizeCountSql:!1,searchCount:!1,maxLimit:0,countId:""}),l=h([]);oe(()=>{O();const t=E.query.query;t&&(i.value=t,M(t),C())});const O=()=>{const t=localStorage.getItem("searchHistory");if(t)try{l.value=JSON.parse(t)}catch(s){console.error("Failed to parse search history:",s),l.value=[]}},U=()=>{localStorage.setItem("searchHistory",JSON.stringify(l.value))},M=t=>{t.trim()&&(l.value=l.value.filter(s=>s.query!==t),l.value.unshift({query:t,timestamp:Date.now()}),l.value.length>20&&(l.value=l.value.slice(0,20)),U())},G=()=>{l.value=[],localStorage.removeItem("searchHistory")},J=(t,s)=>t.length<=s?t:t.substring(0,s)+"...",Q=t=>{i.value=t,D()},C=()=>{i.value.trim()&&(d.value=!0,ne(le,{query:i.value,currentPage:m.value,pageSize:b.value}).then(t=>{t.data&&t.data.result&&(t.data.global&&B.setGlobal(t.data.global),Object.assign(g,t.data.result),L.value=Number(t.data.result.pages||0),m.value=Number(t.data.result.current||1))}).catch(t=>{console.error("Failed to fetch query articles:",t)}).finally(()=>{d.value=!1}))},D=()=>{i.value.trim()&&(m.value=1,M(i.value),C(),j.push({path:"/query-article",query:{query:i.value}}))},K=t=>{b.value=t,C()},Y=t=>{m.value=t,C()},R=t=>{if(!i.value||!t)return t||"";const s=i.value.split(/\s+/).filter(n=>n.trim());if(s.length===0)return t;const y=new RegExp(`(${s.map(n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`,"gi");return t.replace(y,'<span class="highlight">$1</span>')},W=t=>{if(!t)return"";const s=new Date(t),y=new Date,n=y.getTime()-s.getTime();if(n<6e4)return"刚刚";if(n<36e5)return Math.floor(n/6e4)+"分钟前";if(n<864e5)return Math.floor(n/36e5)+"小时前";if(n<2592e6)return Math.floor(n/864e5)+"天前";const S=s.getFullYear(),x=String(s.getMonth()+1).padStart(2,"0"),w=String(s.getDate()).padStart(2,"0");return S===y.getFullYear()?`${x}-${w}`:`${S}-${x}-${w}`};A("loginDialogClicked",()=>{q.value=!q.value});const q=h(!1);A("registerDialogClicked",()=>{T.value=!T.value});const T=h(!1);return(t,s)=>{const y=u("el-input"),n=u("el-icon"),S=u("el-icon-menu"),x=u("el-icon-delete"),w=u("el-icon-arrow-right"),H=u("el-skeleton-item"),X=u("router-link"),Z=u("el-pagination"),ee=u("el-skeleton");return r(),c(I,null,[e("div",me,[o(he),e("div",ye,[e("div",fe,[o(y,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=a=>i.value=a),placeholder:"输入搜索内容...","prefix-icon":F(P),"suffix-icon":d.value?"el-icon-loading":"",onKeyup:ie(D,["enter"]),clearable:"",class:"modern-search-input"},null,8,["modelValue","prefix-icon","suffix-icon"]),e("button",{onClick:D,class:V(["modern-search-button",{searching:d.value}]),disabled:d.value},[e("span",be,[o(n,{class:V(["search-button-icon",{rotating:d.value}])},{default:v(()=>[o(F(P))]),_:1},8,["class"]),Ce]),Se],10,ke)]),l.value.length>0?(r(),c("div",xe,[e("div",we,[e("span",He,[o(n,{class:"history-icon"},{default:v(()=>[o(S)]),_:1}),p(" 搜索历史 ")]),e("button",{onClick:G,class:"clear-history-btn"},[o(n,null,{default:v(()=>[o(x)]),_:1}),p(" 清空 ")])]),e("div",Ie,[(r(!0),c(I,null,z(l.value,(a,$)=>(r(),c("div",{key:$,class:"history-item",onClick:at=>Q(a.query),title:a.query},[e("span",qe,f(J(a.query,4)),1),o(n,{class:"history-arrow"},{default:v(()=>[o(w)]),_:1})],8,De))),128))])])):N("",!0)]),e("div",Te,[o(ee,{loading:d.value,animated:"",throttle:200,class:"skeleton-container"},{template:v(()=>[e("div",$e,[e("div",ze,[Ne,(r(),c(I,null,z(6,(a,$)=>e("div",{key:$,class:"article-skeleton"},[o(H,{variant:"text",style:{width:"80%",height:"24px","margin-bottom":"10px"}}),o(H,{variant:"text",style:{width:"100%",height:"60px","margin-bottom":"10px"}}),o(H,{variant:"text",style:{width:"60%",height:"18px"}}),Le])),64)),o(H,{variant:"text",style:{width:"40%",height:"40px",margin:"20px auto"}})])])]),default:v(()=>[e("div",Me,[e("div",Re,[Fe,g.records&&g.records.length>0?(r(),c("div",Ve,[e("div",Ae,[(r(!0),c(I,null,z(g.records,a=>(r(),c("div",{key:a.articleId,class:"article-item"},[o(X,{to:`/article/detail/${a.articleId}`,class:"article-link"},{default:v(()=>[e("h3",{class:"article-title",innerHTML:R(a.title)},null,8,Pe),e("div",{class:"article-summary",innerHTML:R(a.summary||"")},null,8,Ee),e("div",je,[e("span",Be,[e("img",{src:a.authorAvatar||"/favicon.ico",alt:a.authorName,class:"author-avatar"},null,8,Oe),p(" "+f(a.authorName),1)]),e("span",Ue,f(W(a.createTime)),1),e("span",Ge,[Je,p(" "+f(a.count.readCnt||0),1)]),e("span",Qe,[Ke,p(" "+f(a.count.commentCnt||0),1)])])]),_:2},1032,["to"])]))),128))])])):d.value?N("",!0):(r(),c("div",Ye,Xe)),g.records&&g.records.length>0?(r(),c("div",Ze,[o(Z,{"page-sizes":[10,20],"hide-on-single-page":"","current-page":m.value,"onUpdate:currentPage":[s[1]||(s[1]=a=>m.value=a),Y],"page-size":b.value,"onUpdate:pageSize":[s[2]||(s[2]=a=>b.value=a),K],layout:"sizes, prev, pager, next, jumper, total","page-count":L.value,total:g.total||0,"default-current-page":1,class:"pagination"},null,8,["current-page","page-size","page-count","total"])])):N("",!0)])])]),_:1},8,["loading"])]),o(_e)]),o(ce,{clicked:q.value},null,8,["clicked"]),o(re,{clicked:T.value},null,8,["clicked"])],64)}}}),nt=pe(et,[["__scopeId","data-v-cd509a1a"]]);export{nt as default};
