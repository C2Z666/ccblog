import{d as te,u as se,r as h,a3 as ae,a1 as oe,l as ne,c as i,a as e,b as o,h as V,b2 as le,O as L,e as v,y as p,F as $,i as N,g as T,a6 as ce,aC as ie,$ as re,j as ue,a0 as P,n as u,o as r,a7 as de,bH as R,t as f,a8 as he,D as _e,E as ge,_ as ve}from"./index-BJr7Wf6Y.js";const _=k=>(_e("data-v-3b583ccd"),k=k(),ge(),k),pe={class:"query-article-container"},me={class:"search-section enhanced-search-section"},ye={class:"search-box modern-search-box"},fe=["disabled"],ke={class:"search-button-content"},be=_(()=>e("span",null,"搜索",-1)),Ce=_(()=>e("span",{class:"search-pulse"},null,-1)),Se={key:0,class:"search-history-container"},xe={class:"search-history-header"},we={class:"history-title"},He={class:"search-history-list"},qe=["onClick","title"],De={class:"history-text"},$e={class:"content-container"},ze={class:"main-content"},Ie={class:"article-area"},Ne=_(()=>e("div",{class:"section-header mb-4"},[e("h2",{class:"section-title"},[e("i",{class:"el-icon-document"}),p(" 搜索结果 ")]),e("div",{class:"section-divider"})],-1)),Te=_(()=>e("div",{class:"skeleton-divider"},null,-1)),Me={class:"main-content"},Fe={class:"article-area"},Ve=_(()=>e("div",{class:"section-header mb-6"},[e("h2",{class:"section-title"},[e("i",{class:"el-icon-document-checked"}),p(" 搜索结果 ")]),e("div",{class:"section-divider"})],-1)),Le={key:0,class:"article-list-wrapper"},Pe={class:"articles-grid"},Re=["innerHTML"],je=["innerHTML"],Ae={class:"article-meta"},Be={class:"author-info"},Oe=["src","alt"],Ee={class:"article-date"},Ge={class:"article-stats"},Qe=_(()=>e("i",{class:"el-icon-view"},null,-1)),Ue={class:"article-stats"},Je=_(()=>e("i",{class:"el-icon-message"},null,-1)),Ke={key:1,class:"empty-state"},Ye=_(()=>e("div",{class:"empty-content"},[e("div",{class:"empty-icon"},[e("i",{class:"el-icon-search"})]),e("h3",null,"未找到相关内容"),e("p",{class:"empty-desc"},"尝试使用其他关键词进行搜索")],-1)),We=[Ye],Xe={key:2,class:"pagination-container"},Ze=te({__name:"QueryArticle",setup(k){const j=re(),A=ue(),B=se(),c=h(""),d=h(!1),m=h(1),M=h(0),b=h(10),g=ae({records:[],total:0,size:10,current:1,pages:0,orders:[],optimizeCountSql:!1,searchCount:!1,maxLimit:0,countId:""}),l=h([]);oe(()=>{O();const t=j.query.query;t&&(c.value=t,C())});const O=()=>{const t=localStorage.getItem("searchHistory");if(t)try{l.value=JSON.parse(t)}catch(s){console.error("Failed to parse search history:",s),l.value=[]}},E=()=>{localStorage.setItem("searchHistory",JSON.stringify(l.value))},G=t=>{t.trim()&&(l.value=l.value.filter(s=>s.query!==t),l.value.unshift({query:t,timestamp:Date.now()}),l.value.length>20&&(l.value=l.value.slice(0,20)),E())},Q=()=>{l.value=[],localStorage.removeItem("searchHistory")},U=(t,s)=>t.length<=s?t:t.substring(0,s)+"...",J=t=>{c.value=t,z()},C=()=>{c.value.trim()&&(d.value=!0,ne("article/query",{query:c.value,currentPage:m.value,pageSize:b.value}).then(t=>{t.data&&t.data.result&&(t.data.global&&B.setGlobal(t.data.global),Object.assign(g,t.data.result),M.value=Number(t.data.result.pages||0),m.value=Number(t.data.result.current||1))}).catch(t=>{console.error("Failed to fetch query articles:",t)}).finally(()=>{d.value=!1}))},z=()=>{c.value.trim()&&(m.value=1,G(c.value),C(),A.push({path:"/query-article",query:{query:c.value}}))},K=t=>{b.value=t,C()},Y=t=>{m.value=t,C()},F=t=>{if(!c.value||!t)return t||"";const s=c.value.split(/\s+/).filter(n=>n.trim());if(s.length===0)return t;const y=new RegExp(`(${s.map(n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`,"gi");return t.replace(y,'<span class="highlight">$1</span>')},W=t=>{if(!t)return"";const s=new Date(t),y=new Date,n=y.getTime()-s.getTime();if(n<6e4)return"刚刚";if(n<36e5)return Math.floor(n/6e4)+"分钟前";if(n<864e5)return Math.floor(n/36e5)+"小时前";if(n<2592e6)return Math.floor(n/864e5)+"天前";const w=s.getFullYear(),H=String(s.getMonth()+1).padStart(2,"0"),q=String(s.getDate()).padStart(2,"0");return w===y.getFullYear()?`${H}-${q}`:`${w}-${H}-${q}`};P("loginDialogClicked",()=>{S.value=!S.value,console.log("clicked: ",S.value)});const S=h(!1);P("registerDialogClicked",()=>{x.value=!x.value,console.log("clicked: ",x.value)});const x=h(!1);return(t,s)=>{const y=u("el-input"),n=u("el-icon"),w=u("el-icon-menu"),H=u("el-icon-delete"),q=u("el-icon-arrow-right"),D=u("el-skeleton-item"),X=u("router-link"),Z=u("el-pagination"),ee=u("el-skeleton");return r(),i($,null,[e("div",pe,[o(de),e("div",me,[e("div",ye,[o(y,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=a=>c.value=a),placeholder:"输入搜索内容...","prefix-icon":V(R),"suffix-icon":d.value?"el-icon-loading":"",onKeyup:le(z,["enter"]),clearable:"",class:"modern-search-input"},null,8,["modelValue","prefix-icon","suffix-icon"]),e("button",{onClick:z,class:L(["modern-search-button",{searching:d.value}]),disabled:d.value},[e("span",ke,[o(n,{class:L(["search-button-icon",{rotating:d.value}])},{default:v(()=>[o(V(R))]),_:1},8,["class"]),be]),Ce],10,fe)]),l.value.length>0?(r(),i("div",Se,[e("div",xe,[e("span",we,[o(n,{class:"history-icon"},{default:v(()=>[o(w)]),_:1}),p(" 搜索历史 ")]),e("button",{onClick:Q,class:"clear-history-btn"},[o(n,null,{default:v(()=>[o(H)]),_:1}),p(" 清空 ")])]),e("div",He,[(r(!0),i($,null,N(l.value,(a,I)=>(r(),i("div",{key:I,class:"history-item",onClick:st=>J(a.query),title:a.query},[e("span",De,f(U(a.query,4)),1),o(n,{class:"history-arrow"},{default:v(()=>[o(q)]),_:1})],8,qe))),128))])])):T("",!0)]),e("div",$e,[o(ee,{loading:d.value,animated:"",throttle:200,class:"skeleton-container"},{template:v(()=>[e("div",ze,[e("div",Ie,[Ne,(r(),i($,null,N(6,(a,I)=>e("div",{key:I,class:"article-skeleton"},[o(D,{variant:"text",style:{width:"80%",height:"24px","margin-bottom":"10px"}}),o(D,{variant:"text",style:{width:"100%",height:"60px","margin-bottom":"10px"}}),o(D,{variant:"text",style:{width:"60%",height:"18px"}}),Te])),64)),o(D,{variant:"text",style:{width:"40%",height:"40px",margin:"20px auto"}})])])]),default:v(()=>[e("div",Me,[e("div",Fe,[Ve,g.records&&g.records.length>0?(r(),i("div",Le,[e("div",Pe,[(r(!0),i($,null,N(g.records,a=>(r(),i("div",{key:a.articleId,class:"article-item"},[o(X,{to:`/article/detail/${a.articleId}`,class:"article-link"},{default:v(()=>[e("h3",{class:"article-title",innerHTML:F(a.title)},null,8,Re),e("div",{class:"article-summary",innerHTML:F(a.summary||"")},null,8,je),e("div",Ae,[e("span",Be,[e("img",{src:a.authorAvatar||"/favicon.ico",alt:a.authorName,class:"author-avatar"},null,8,Oe),p(" "+f(a.authorName),1)]),e("span",Ee,f(W(a.createTime)),1),e("span",Ge,[Qe,p(" "+f(a.count.readCnt||0),1)]),e("span",Ue,[Je,p(" "+f(a.count.commentCnt||0),1)])])]),_:2},1032,["to"])]))),128))])])):d.value?T("",!0):(r(),i("div",Ke,We)),g.records&&g.records.length>0?(r(),i("div",Xe,[o(Z,{"page-sizes":[10,20],"hide-on-single-page":"","current-page":m.value,"onUpdate:currentPage":[s[1]||(s[1]=a=>m.value=a),Y],"page-size":b.value,"onUpdate:pageSize":[s[2]||(s[2]=a=>b.value=a),K],layout:"sizes, prev, pager, next, jumper, total","page-count":M.value,total:g.total||0,"default-current-page":1,class:"pagination"},null,8,["current-page","page-size","page-count","total"])])):T("",!0)])])]),_:1},8,["loading"])]),o(he)]),o(ce,{clicked:S.value},null,8,["clicked"]),o(ie,{clicked:x.value},null,8,["clicked"])],64)}}}),ot=ve(Ze,[["__scopeId","data-v-3b583ccd"]]);export{ot as default};
